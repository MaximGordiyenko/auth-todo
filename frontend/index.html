<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
</head>
<body>
<h1>Welcome Login/Register please</h1>
<form id="loginFormId" action="/login" method="post">
    <label>Username:
        <input type="text" name="name">
    </label>
    <label>Password:
        <input type="text" name="password">
    </label>
    <input type="submit" name="submit">
</form>

<a href="/register">register</a>

<script>
    document.forms['loginFormId'].addEventListener('submit',
      (event) => {
          event.preventDefault();
          fetch((event.target.action), {//http://localhost:4000/login
              method: 'POST',
              body: new URLSearchParams(new FormData(event.target))
          })
            .then((res) => {
                console.log('/login: POST data from login to server');
                return res.json()
            })
            .then((jsonData) => {
                let userToken = jsonData;
                console.log(jsonData);
                //store token
                window.localStorage.setItem(
                  'token',
                  JSON.stringify(userToken));
                console.log();
                let newRequest = new XMLHttpRequest();
                newRequest.withCredentials = true;
                newRequest.open("GET", "/todos/");
                newRequest.setRequestHeader("Authorization", "Basic " + userToken.toString());
                newRequest.send();
                // window.location.replace("/todos/" + userToken.token.toString());
            })
            .catch((err) => {
                console.error(err);
            });
      });
</script>
</body>
</html>
